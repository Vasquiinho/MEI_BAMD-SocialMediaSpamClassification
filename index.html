<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>

    <div class="card text-center">
        <div class="card-header">
            <ul class="nav nav-tabs card-header-tabs">
                <li class="nav-item">
                    <a class="nav-link active" href="#" id="geral">Texto Livre</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="fb">Facebook</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="imdb">IMDb</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="reddit">Reddit</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="youtube">Youtube</a>
                </li>
            </ul>
        </div>

        <div class="card-body" id="card_geral">
            <div class="d-flex justify-content-center flex-wrap align-items-center flex-column">
                <div style="width: 80%; text-align: left; border: 1px solid #222; border-left: 8px solid #222; margin-bottom: 16px;">
                    <h5 class="card-title m-0" style="padding: 12px"><i><b>Classificação de texto livre</b></i></h5>
                </div>
                <div style="width: 80%; text-align: left;">
                    <form>
                        <div class="form-group">
                            <label for="textAreaGeral">Texto a classificar</label>
                            <textarea class="form-control" id="textAreaGeral" rows="3"></textarea>
                            <small class="form-text text-muted">Insira o texto que pretende verificar se é
                                spam ou não</small>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="classificaGeral()">Submeter</button>
                    </form>
                </div>
                <div style="width: 80%; text-align: left; margin-top: 16px">
                    <table class="table table-striped" id="tbl_ultimo_resultado_geral">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col" colspan="2">Último Resultado:</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <th scope="row">Info</th>
                            <td>Ainda sem dados a apresentar...</td>
                          </tr>
                        </tbody>
                      </table>
                </div>
            </div>
        </div>

        <div class="card-body" id="card_fb">
            <div class="d-flex justify-content-center flex-wrap align-items-center flex-column">
                <div style="width: 80%; text-align: left; border: 1px solid blue; border-left: 8px solid blue; margin-bottom: 16px;">
                    <h5 class="card-title m-0" style="padding: 12px"><i><b>Obter comentários do Facebook e respetivas classificações</b></i></h5>
                </div>
                <div style="width: 80%; text-align: left;">
                    <form>
                        <div class="form-group">
                            <label for="fb_apikey">Chave API</label>
                            <input type="text" class="form-control" id="fb_apikey" placeholder="Chave de api do facebook">
                            <small>De <a href="https://developers.facebook.com/tools/explorer/">https://developers.facebook.com/tools/explorer/</a></small>
                        </div>
                        <div class="form-group">
                            <label for="fb_idpub">Id da publicação</label>
                            <input type="text" class="form-control" id="fb_idpub" placeholder="Id da publicação do facebook">
                        </div>
                        <div class="form-group">
                            <label for="fb_max">Quantidade máxima de comentários a obter</label>
                            <input type="number" class="form-control" id="fb_max" placeholder="Quantidade de comentários a obter">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="classificaFB()">Submeter</button>
                    </form>
                </div>
                <div style="width: 80%; text-align: left; margin-top: 16px">
                    <table class="table table-striped" id="tbl_ultimo_resultado_fb">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col" colspan="2">Último Resultado:</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <th scope="row">Info</th>
                            <td>Ainda sem dados a apresentar...</td>
                          </tr>
                        </tbody>
                      </table>
                </div>
            </div>
        </div>

        <div class="card-body" id="card_imdb">
            <div class="d-flex justify-content-center flex-wrap align-items-center flex-column">
                <div style="width: 80%; text-align: left; border: 1px solid yellow; border-left: 8px solid yellow; margin-bottom: 16px;">
                    <h5 class="card-title m-0" style="padding: 12px"><i><b>Obter comentários do IMDb e respetivas classificações</b></i></h5>
                </div>
                <div style="width: 80%; text-align: left;">
                    <form>
                        <div class="form-group">
                            <label for="imdb_link">Link para a página de reviews</label>
                            <input type="text" class="form-control" id="imdb_link" placeholder="Link para a página de reviews">
                            <small>Exemplo: <a href="https://www.imdb.com/title/tt0111161/reviews?ref_=tt_urv">https://www.imdb.com/title/tt0111161/reviews?ref_=tt_urv</a></small>
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="classificaIMDb()">Submeter</button>
                    </form>
                </div>
                <div style="width: 80%; text-align: left; margin-top: 16px">
                    <table class="table table-striped" id="tbl_ultimo_resultado_imdb">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col" colspan="2">Último Resultado:</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <th scope="row">Info</th>
                            <td>Ainda sem dados a apresentar...</td>
                          </tr>
                        </tbody>
                      </table>
                </div>
            </div>
        </div>

        <div class="card-body" id="card_yt">
            <div class="d-flex justify-content-center flex-wrap align-items-center flex-column">
                <div style="width: 80%; text-align: left; border: 1px solid red; border-left: 8px solid red; margin-bottom: 16px;">
                    <h5 class="card-title m-0" style="padding: 12px"><i><b>Obter comentários do Youtube e respetivas classificações</b></i></h5>
                </div>
                <div style="width: 80%; text-align: left;">
                    <form>
                        <div class="form-group">
                            <label for="yt_apikey">Chave API</label>
                            <input type="text" class="form-control" id="yt_apikey" placeholder="Chave de api do youtube">
                            <small>De <a href="https://console.cloud.google.com/apis/credentials">https://console.cloud.google.com/apis/credentials (deve ter Youtube Data API v3 ativado)</a></small>
                        </div>
                        <div class="form-group">
                            <label for="yt_idvideo">Id do vídeo</label>
                            <input type="text" class="form-control" id="yt_idvideo" placeholder="Id do vídeo do Youtube">
                        </div>
                        <div class="form-group">
                            <label for="yt_max">Quantidade máxima de comentários a obter</label>
                            <input type="number" class="form-control" id="yt_max" placeholder="Quantidade de comentários a obter">
                        </div>
                        <button type="button" class="btn btn-primary" onclick="classificaYT()">Submeter</button>
                    </form>
                </div>
                <div style="width: 80%; text-align: left; margin-top: 16px">
                    <table class="table table-striped" id="tbl_ultimo_resultado_yt">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col" colspan="2">Último Resultado:</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <th scope="row">Info</th>
                            <td>Ainda sem dados a apresentar...</td>
                          </tr>
                        </tbody>
                      </table>
                </div>
            </div>
        </div>

        <div class="card-body" id="card_reddit">
            <div class="d-flex justify-content-center flex-wrap align-items-center flex-column">
                <div style="width: 80%; text-align: left; border: 1px solid orange; border-left: 8px solid orange; margin-bottom: 16px;">
                    <h5 class="card-title m-0" style="padding: 12px"><i><b>Obter comentários do Reddit e respetivas classificações</b></i></h5>
                </div>
                <div style="width: 80%; text-align: left;">
                    <form>
                        <div class="form-group">
                            <label for="reddit_link">Link para a publicação do Reddit</label>
                            <input type="text" class="form-control" id="reddit_link" placeholder="Link para a publicação">
                            <small>Exemplo: <a href="https://www.reddit.com/r/memes/comments/o11m8p/robots_have_feelings_too/">https://www.reddit.com/r/memes/comments/o11m8p/robots_have_feelings_too/</a></small>
                        </div>
                        
                        <button type="button" class="btn btn-primary" onclick="classificaReddit()">Submeter</button>
                    </form>
                </div>
                <div style="width: 80%; text-align: left; margin-top: 16px">
                    <table class="table table-striped" id="tbl_ultimo_resultado_reddit">
                        <thead class="thead-dark">
                          <tr>
                            <th scope="col" colspan="2">Último Resultado:</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <th scope="row">Info</th>
                            <td>Ainda sem dados a apresentar...</td>
                          </tr>
                        </tbody>
                      </table>
                </div>
            </div>
        </div>
    </div>


    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: rgba(255, 255, 255, .8) url('http://i.stack.imgur.com/FhHRx.gif') 50% 50% no-repeat;
        }

        /* When the body has the loading class, we turn
            the scrollbar off with overflow:hidden */
        body.loading .modal {
            overflow: hidden;
        }

        /* Anytime the body has the loading class, our
             modal element will be visible */
        body.loading .modal {
            display: block;
        }
    </style>
    <div class="modal">
        <!-- Place at bottom of page -->
    </div>

</body>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
<script>
    $(document).on({
        ajaxStart: function () { $("body").addClass("loading"); },
        ajaxStop: function () { $("body").removeClass("loading"); }
    });

    function classificaGeral(){
        if(!$("#textAreaGeral").val()) {
            alert("É necessário preencher a àrea de texto")
            return;
        }
        $("#tbl_ultimo_resultado_geral").hide();
        $("#tbl_ultimo_resultado_geral tbody tr").remove();
        $.post({
            url: "http://localhost:5002/geral",
            data: {
                texto: $("#textAreaGeral").val()
            },
            success: function(dados){
                $("#tbl_ultimo_resultado_geral tbody").append("<tr><td>Texto</td><td>"+$("#textAreaGeral").val()+"</td></tr>");
                Object.keys(dados.resultado).forEach(function(chave){
                    $("#tbl_ultimo_resultado_geral tbody").append("<tr><td>"+chave+"</td><td>"+parseFloat(dados.resultado[chave].prob*100).toFixed(2)+"% -> "+dados.resultado[chave].label+"</td></tr>");
                })
                $("#tbl_ultimo_resultado_geral").show();
            },
            error: function(e){
                alert("Ocorreu um erro a obter dados! Verifique a consola para mais informação!");
                console.log(e)
            }
        });
    }

    function classificaFB(){
        if(!$("#fb_apikey").val() || !$("#fb_idpub").val() || !$("#fb_max").val()) {
            alert("É necessário preencher todos os dados")
            return;
        }
        $("#tbl_ultimo_resultado_fb").hide();
        $("#tbl_ultimo_resultado_fb tbody tr").remove();
        $.post({
            url: "http://localhost:5002/fb",
            data: {
                idpub: $("#fb_idpub").val(),
                chave: $("#fb_apikey").val(),
                limite: $("#fb_max").val()
            },
            success: function(dados){
                Object.keys(dados.resultado).forEach(function(chave){
                    $("#tbl_ultimo_resultado_fb tbody").append("<tr class='thead-dark'><th colspan=2></th></tr>");
                    $("#tbl_ultimo_resultado_fb tbody").append("<tr><td>Comentário</td><td>"+ dados.resultado[chave].comentario + "</td></tr>");
                    Object.keys(dados.resultado[chave].res_classificadores).forEach(function(chave2){
                        $("#tbl_ultimo_resultado_fb tbody").append("<tr><td>"+chave2+"</td><td>"+parseFloat(dados.resultado[chave].res_classificadores[chave2].prob*100).toFixed(2)+"% -> "+ dados.resultado[chave].res_classificadores[chave2].label + "</td></tr>");
                    })
                })
                $("#tbl_ultimo_resultado_fb").show();
            },
            error: function(e){
                alert("Ocorreu um erro a obter dados! Verifique a consola para mais informação!");
                console.log(e)
                $("body").removeClass("loading");
            }
        });
    }

    function classificaYT(){
        if(!$("#yt_apikey").val() || !$("#yt_idvideo").val() || !$("#yt_max").val()) {
            alert("É necessário preencher todos os dados")
            return;
        }
        $("#tbl_ultimo_resultado_yt").hide();
        $("#tbl_ultimo_resultado_yt tbody tr").remove();
        $.post({
            url: "http://localhost:5002/yt",
            data: {
                idvideo: $("#yt_idvideo").val(),
                chave: $("#yt_apikey").val(),
                limite: $("#yt_max").val()
            },
            success: function(dados){
                Object.keys(dados.resultado).forEach(function(chave){
                    $("#tbl_ultimo_resultado_yt tbody").append("<tr class='thead-dark'><th colspan=2></th></tr>");
                    $("#tbl_ultimo_resultado_yt tbody").append("<tr><td>Comentário</td><td>"+ dados.resultado[chave].comentario + "</td></tr>");
                    Object.keys(dados.resultado[chave].res_classificadores).forEach(function(chave2){
                        $("#tbl_ultimo_resultado_yt tbody").append("<tr><td>"+chave2+"</td><td>"+parseFloat(dados.resultado[chave].res_classificadores[chave2].prob*100).toFixed(2)+"% -> "+ dados.resultado[chave].res_classificadores[chave2].label + "</td></tr>");
                    })
                })
                $("#tbl_ultimo_resultado_yt").show();
            },
            error: function(e){
                alert("Ocorreu um erro a obter dados! Verifique a consola para mais informação!");
                console.log(e)
                $("body").removeClass("loading");
            }
        });
    }

    function classificaReddit(){
        if(!$("#reddit_link").val()) {
            alert("É necessário preencher todos os dados")
            return;
        }
        $("#tbl_ultimo_resultado_reddit").hide();
        $("#tbl_ultimo_resultado_reddit tbody tr").remove();
        $.post({
            url: "http://localhost:5002/reddit",
            data: {
                reddit_link: $("#reddit_link").val()
            },
            success: function(dados){
                Object.keys(dados.resultado).forEach(function(chave){
                    $("#tbl_ultimo_resultado_reddit tbody").append("<tr class='thead-dark'><th colspan=2></th></tr>");
                    $("#tbl_ultimo_resultado_reddit tbody").append("<tr><td>Comentário</td><td>"+ dados.resultado[chave].comentario + "</td></tr>");
                    Object.keys(dados.resultado[chave].res_classificadores).forEach(function(chave2){
                        $("#tbl_ultimo_resultado_reddit tbody").append("<tr><td>"+chave2+"</td><td>"+parseFloat(dados.resultado[chave].res_classificadores[chave2].prob*100).toFixed(2)+"% -> "+ dados.resultado[chave].res_classificadores[chave2].label + "</td></tr>");
                    })
                })
                $("#tbl_ultimo_resultado_reddit").show();
            },
            error: function(e){
                alert("Ocorreu um erro a obter dados! Verifique a consola para mais informação!");
                console.log(e)
                $("body").removeClass("loading");
            }
        });
    }

    function classificaIMDb(){
        if(!$("#imdb_link").val()) {
            alert("É necessário preencher todos os dados")
            return;
        }
        $("#tbl_ultimo_resultado_imdb").hide();
        $("#tbl_ultimo_resultado_imdb tbody tr").remove();
        $.post({
            url: "http://localhost:5002/imdb",
            data: {
                imdb_link: $("#imdb_link").val()
            },
            success: function(dados){
                Object.keys(dados.resultado).forEach(function(chave){
                    $("#tbl_ultimo_resultado_imdb tbody").append("<tr class='thead-dark'><th colspan=2></th></tr>");
                    $("#tbl_ultimo_resultado_imdb tbody").append("<tr><td>Comentário</td><td>"+ dados.resultado[chave].comentario + "</td></tr>");
                    Object.keys(dados.resultado[chave].res_classificadores).forEach(function(chave2){
                        $("#tbl_ultimo_resultado_imdb tbody").append("<tr><td>"+chave2+"</td><td>"+parseFloat(dados.resultado[chave].res_classificadores[chave2].prob*100).toFixed(2)+"% -> "+ dados.resultado[chave].res_classificadores[chave2].label + "</td></tr>");
                    })
                })
                $("#tbl_ultimo_resultado_imdb").show();
            },
            error: function(e){
                alert("Ocorreu um erro a obter dados! Verifique a consola para mais informação!");
                console.log(e)
                $("body").removeClass("loading");
            }
        });
    }


    $(".card-body").hide();
    $("#card_geral").show();

    $(".nav-item").click(function (ev) {
        $(".nav-item").each(function () {
            $(this).children(":first").removeClass("active");
        });

        $(this).children(":first").addClass("active");
        $(".card-body").hide();

        switch ($(this).children(":first").attr("id")) {
            case "fb":
                $("#card_fb").show();
                break;
            case "imdb":
                $("#card_imdb").show();
                break;
            case "youtube":
                $("#card_yt").show();
                break;
            case "reddit":
                $("#card_reddit").show();
                break;
            default:
                $("#card_geral").show();
        }
    })

</script>

</html>